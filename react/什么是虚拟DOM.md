# 什么是虚拟DOM

虚拟DOM（VDOM）是真实DOM的内存表示，一种编程概念，一种模式。

它会和真实的DOM同步，比如通过ReactDOM这种库，这个同步的过程叫做调和



虚拟DOM是将状态映射成视图的众多解决方案中的一种，其是通过状态生成一个虚拟节点树，然后使用虚拟节点树进行渲染生成真实DOM，在渲染之前，会使用新生成的虚拟节点树和上一次虚拟节点树进行对比，只渲染不同的部分



优点：速度快，效率高

**优点：**

- *保证性能下限：* 框架的虚拟 DOM 需要`适配任何上层 API` 可能产生的操作，它的一些 DOM 操作的实现必须`是普适的`，所以它的性能`并不是最优的`；但是比起粗暴的 DOM 操作性能要好很多，因此框架的虚拟 DOM 至少可以保证在你不需要手动优化的情况下，依然可以提供还不错的性能，即保证性能的下限；
- *无需手动操作 DOM：* 我们不再需要手动去操作 DOM，只需要写好 View-Model 的代码逻辑，框架会根据`虚拟 DOM 和 数据双向绑定`，帮我们以可预期的方式更新视图，极大提高我们的开发效率；
- *跨平台：* 虚拟 DOM 本质上是 JavaScript 对象,而 DOM 与平台强相关，相比之下虚拟 DOM 可以进行更方便地跨平台操作，例如服务器渲染、weex 开发等等。

**缺点:**

*无法进行极致优化*： 虽然虚拟 DOM + 合理的优化，足以应对绝大部分应用的性能需求，但在一些性能要求极高的应用中虚拟 DOM 无法进行针对性的极致优化




虚拟DOM的原理：

虚拟 DOM 的实现原理主要包括以下 3 部分：

- 用 JavaScript 对象模拟真实 DOM 树，对真实 DOM 进行抽象；
- diff 算法 — 比较两棵虚拟 DOM 树的差异；
- pach 算法 — 将两个虚拟 DOM 对象的差异应用到真正的 DOM 树。







虚拟DOM与真实DOM的区别？

1、虚拟DOM不会进行重排与重绘操作；

2、虚拟DOM进行频繁修改，然后一次性比较并修改真实DOM中需要修改的部分，最后进行重排和重绘，减少过多DOM节点重排和重绘损耗。

3、虚拟DOM有效降低大面积（真实DOM节点）的重排和重绘，因为最终与真实DOM比较差异，可以局部渲染。





#### Vue中如何实现一个虚拟DOM？说说你的思路

<details open="">
    <summary>参考答案</summary>
首先要构建一个VNode的类，DOM元素上的所有属性在VNode类实例化出来的对象上都存在对应的属性。例如tag表示一个元素节点的名称，text表示一个文本节点的文本，chlidren表示子节点等。将VNode类实例化出来的对象进行分类，例如注释节点、文本节点、元素节点、组件节点、函数式节点、克隆节点。
<p>然后通过编译将模板转成渲染函数render，执行渲染函数render，在其中创建不同类型的VNode类，最后整合就可以得到一个虚拟DOM（vnode）。</p>
<p>最后通过patch将vnode和oldVnode进行比较后，生成真实DOM。</p></details>







虚拟DOM作用

- 可以维护视图和状态之间的关系
- 复杂视图情况下提升渲染性能
- 虚拟DOM除了可以渲染成DOM节点，还可以渲染到其他平台如ssr(nuxt.js/next.js)、原生应用（weex/rn）、小程序等，增加了跨平台能力