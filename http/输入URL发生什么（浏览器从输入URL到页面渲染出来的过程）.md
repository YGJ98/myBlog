# 输入URL发生什么（浏览器从输入URL到页面渲染出来的过程）

**从输入URL到渲染出整个页面的过程包括三个部分：**

1、DNS解析URL的过程

2、浏览器发送请求与服务器交互的过程

3、浏览器对接收到的html页面渲染的过程

**一、DNS解析URL的过程**

   DNS解析的过程就是寻找哪个服务器上有请求的资源。因为ip地址不容易记忆，一般会使用URL域名（如www.baidu.com）作为网址。DNS解析就是将域名翻译成IP地址的过程。

具体过程：

​    1）浏览器缓存：浏览器会按照一定的频率 缓存DNS记录

 　2）操作系统缓存：如果浏览器缓存中找不到需要的DNS记录，就会取操作系统中找

　　 3）路由缓存：路由器也有DNS缓存

　　 4）ISP的DNS服务器：ISP有专门的DNS服务器应对DNS查询请求

　　 5）根服务器：ISP的DNS服务器找不到之后，就要向根服务器发出请求，进行递归查询

**二、浏览器与服务器交互过程**

　　1）首先浏览器利用tcp协议通过三次握手与服务器建立连接

　　http请求包括header和body。header中包括请求的方式（get和post）、请求的协议 （http、https、ftp）、请求的地址ip、缓存cookie。body中有请求的内容。

　　2）浏览器根据解析到的IP地址和端口号发起http的get请求.

　　3）服务器接收到http请求之后，开始搜索html页面，并使用http返回响应报文

　　4）若状态码为200显示响应成功，浏览器接收到返回的html页面之后，开始进行页面的渲染

**三、浏览器页面渲染过程**

　　1）浏览器根据深度遍历的方式把html节点遍历成dom 树

　　2）将css解析成CSS DOM树

　　3）将dom树和CSS DOM树构造成render树

　　4）JS根据得到的render树 计算所有节点在屏幕中的位置，进行布局（回流）

　　5）遍历render树并调用硬件API绘制所有节点（重绘）







1.DNS域名解析（域名解析成ip地址，走UTP协议，因此不会有握手过程），浏览器将url解析出相对应的服务器的IP地址（1.本地浏览器的DNS缓存中查找，2.再向系统DNS缓存发送查询请求，3.再向路由器DNS缓存，4.网络运营商DNS缓存，5.递归搜索），并从URL中解析出端口号

**简单的回答如下：**

浏览器从URL中解析出服务器的主机名

浏览器将服务器的主机名转换成服务器的IP地址（DNS），并将端口号从URL中解析出来

2.浏览器与目标服务器建立一条TCP连接（三次握手）

3.浏览器向服务器发送一条HTTP请求报文

4.服务器返回给浏览器一条HTTP响应报文

5.浏览器进行渲染

6.关闭TCP连接（四次挥手）



1.浏览器根据深度遍历的方式把html节点遍历成dom 树

2.将css解析成CSS DOM树

3.将dom树和CSS DOM树构造成render树

4.JS根据得到的render树 计算所有节点在屏幕中的位置，进行布局（回流）

5.遍历render树并调用硬件API绘制所有节点（重绘）



##### 高级回答如下

1.在浏览器地址栏输入URL

2.浏览器查看缓存，请求资源在缓存中并且未过期，跳转到转码步骤 如果浏览器未缓存，发起新的请求已缓存，检验是否过期，未过期直接提供给客户端，否则进行验证检验是否过期 通常有两个http头进行控制，expires和cache-control。

3.浏览器解析URL获取协议，主机，端口，path

4.浏览器组装一个http请求 请求报文

5.浏览器获取主机ip地址：(dns解析过程)过程：浏览器缓存 -> 本地缓存-> hosts文件 -> 路由器缓存 -> ISP DNS缓存 -> DNS递归查询

6.打开一个socket与目标地址建立TCP连接，进行三次握手i. 客户端发送一个TCP的SYN=1，Sep=X的包到服务器端口ii. 服务器返回SYN=1，ACK=X+1，Sep=Y的响应包iii. 客户端发送ACK=Y+1，Sep=Z

7.TCP连接建立发送http请求。

8.服务器接收请求并解析，将请求转发到服务程序

9.服务器检查http请求头是否包含缓存验证信息，如果验证缓存新鲜，返回304等对应状态码

10.处理程序读取完整请求并准备http响应，可能需要查询数据库等操作

11.服务器将响应报文通过TCP连接发送回浏览器

12.浏览器接收到http响应，然后根据情况选择关闭TCP连接或者保留重用。（关闭操作进行第四次挥手）主动方发送Fin=1，Ack=Z，Sep=X的报文被动方发送ACK=X+1，Sep=Z报文被动方发送Fin=1，ACK=X，Sep=Y报文主动方发送ACK=Y，Sep=X报文

13.浏览器检查响应状态码。状态吗不同 解决的方法不同 1XX 3XX 4XX 5XX区别对待2XX是正常返回

14.如果资源可缓存，进行缓存

15.对响应解码 例如gzip压缩

16.根据资源类型决定如何处理

17.假设资源为html文档，解析html文档 构建dom树 下载资源，构建css树，执行js脚本，构建dom树

18.解析过程遇到图片、样式表、js文件、启动下载

19.构建css树

20.根据dom树和css树整合构建渲染树

21.js解析

22.显示页面

![](C:\Users\Administrator\Desktop\面试题\http\输入URL的过程.webp)

# 浏览器建立一条与web服务器TCP连接的时候多了哪些事情

三次握手，四次挥手

**三次握手**

-  	客户端首先发送一个带有SYN标志的数据包给服务器
- ​     服务器接收SYN数据包之后，回传一个SYN/ACK标志的数据包以示传达确认连接信息
- 客户端收到SYN/ACK的确认数据包之后，再回传一个ACK标志的数据包给服务器端，表示“握手”结束

**四次挥手**	

- ​	客户端向服务端先发送一个带有FIN标志的数据包给服务端
- ​    服务端结束FIN数据包之后，回传一个ACK的数据包给客户端以示传达确认关闭信息
- ​    服务端向客户端发送一个FIN标志的数据包，请求关闭连接
- ​    ACK的数据包给服务端，以表示确认关闭







# TCP的作用

- 提供无差错的数据传输
- 按序传输（数据总是会按照发送顺序到达）
- 未分段的数据流（可以在任意时刻以任意尺寸将数据发送出去）