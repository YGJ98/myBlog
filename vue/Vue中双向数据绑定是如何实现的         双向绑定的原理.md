# Vue中双向数据绑定是如何实现的         双向绑定的原理

Vue 数据双向绑定主要是指：**数据变化更新视图，视图变化更新数据**

输入框内容变化时，Data 中的数据同步变化。即 View => Data 的变化。 Data 中的数据变化时，文本节点的内容同步变化。即 Data => View 的变化。

其中，View 变化更新 Data ，可以通过事件监听的方式来实现，所以 Vue 的数据双向绑定的工作主要是`如何根据 Data 变化更新 View`。

Vue 主要通过以下 `4 个步骤`来实现数据双向绑定的：

- *实现一个监听器 Observer*对数据对象进行遍历，包括子属性对象的属性，利用 Object.defineProperty() 对属性都加上 setter 和 getter。这样的话，给这个对象的某个值赋值，就会触发 setter，那么就能监听到了数据变化。
- *实现一个解析器 Compile*解析 Vue 模板指令，将模板中的`变量`都替换成`数据`，然后初始化渲染页面视图，并将每个`指令`对应的`节点`绑定`更新函数`，添加监听数据的订阅者，一旦数据有变动，收到通知，调用`更新函数进行数据更新`。
- *实现一个订阅者* Watcher：Watcher 订阅者是 `Observer 和 Compile 之间通信的桥梁` ，主要的任务是订阅 Observer 中的`属性值变化`的消息，当收到属性值变化的消息时，`触发解析器` Compile 中对应的更新函数。
- *实现一个订阅器 Dep*订阅器采用 `发布-订阅 设计模式`，用来收集订阅者 Watcher，对监听器 Observer 和 订阅者 Watcher 进行统一管理。





**Vue的双向数据绑定是通过数据劫持结合发布者订阅者模式来实现的**

##### vue内部使用object.defineProperty方法给所有数据加上getter和setter方法，在数据发生改变时发布消息给订阅者Watcher，触发响应的监听回调。

也就是说数据和视图同步，数据发生变化，视图跟着变化；视图变化，数据也随着发生改变

实现过程：

首先要对数据进行劫持监听，所以我们需要设置一个监听器Observer，用来监听所有属性。如果属性发上变化了，就需要告诉订阅者Watcher看是否需要更新。因为订阅者是有很多个，所以我们需要有一个消息订阅器Dep来专门收集这些订阅者，然后在监听器Observer和订阅者Watcher之间进行统一管理的。接着，我们还需要有一个指令解析器Compile，对每个节点元素进行扫描和解析，将相关指令对应初始化成一个订阅者Watcher，并替换模板数据或者绑定相应的函数，此时当订阅者Watcher接收到相应属性的变化，就会执行对应的更新函数，从而更新视图

1.实现一个监听器Observer，用来劫持并监听所有属性，如果有变动的，就通知订阅者。

2.实现一个订阅者Watcher，可以收到属性的变化通知并执行相应的函数，从而更新视图。

3.实现一个解析器Compile，可以扫描和解析每个节点的相关指令，并根据初始化模板数据以及初始化相应的订阅器。



![双向绑定原理](C:\Users\Administrator\Desktop\面试题\vue\双向绑定原理.png)





# vue3是如何实现的双向绑定

采用Proxy来实现数据劫持，其他的相同











# Proxy与Object.defineProperty的优劣对比

proxy可以直接监听对象而非对象属性，proxy的代理针对的是整个对象而不是像object.defineProperty针对某个属性,

proxy可以直接监听数组的变化，只需要做一层代理就可以监听同级结构下的所有属性变化,    包括新增的属性和删除的属性

proxy多达13种拦截方法，不限于apply/ownKeys、has等，最常用的就是set和get

proxy返回的是一个新对象，可以只操作新的对象达到目的，而Object.Object.defineProperty只能遍历对象属性直接修改

proxy作为新标准收到浏览器厂商重点持续的性能优化

Object.Object.defineProperty兼容性好，支持IE9，而proxy存在浏览器兼容性问题，无法用polyfill磨平





